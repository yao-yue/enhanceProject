## è·¨åŸŸ9æ³•
è·¨åŸŸï¼šè¿èƒŒåŒæºç­–ç•¥çš„è¡Œä¸ºå°±å«è·¨åŸŸï¼ŒåŒæºç­–ç•¥ï¼šåè®®ã€åŸŸåã€ç«¯å£éƒ½è¦ç›¸åŒã€‚    
è·¨åŸŸå¹¶ä¸æ˜¯è¯·æ±‚å‘ä¸å‡ºå»ï¼Œè¯·æ±‚èƒ½å‘å‡ºå»ï¼ŒæœåŠ¡ç«¯èƒ½æ”¶åˆ°è¯·æ±‚å¹¶æ­£å¸¸è¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœè¢«æµè§ˆå™¨æ‹¦æˆªäº†

9ç§æ–¹æ³•ï¼šjsonp\cors\postMessage\websocket\Nodeä¸­é—´ä»¶ä»£ç†\
nginxåå‘ä»£ç†\window.name+iframe\location.hash+iframe\document.domin+iframe

### çŸ¥è¯†é“ºå« iframeï¼ˆå†…è”æ¡†æ¶å…ƒç´ ï¼‰
å¯ä»¥æŠŠå¦ä¸€ä¸ªhtmlé¡µé¢åµŒå…¥åˆ°å½“å‰é¡µé¢ä¸Š

### jsonp
æ ¸å¿ƒæ­¥éª¤ï¼š åˆ›å»ºscriptæ ‡ç­¾ï¼›å†™å›è°ƒå‡½æ•°ï¼› script.srcï¼›æŠŠscriptã€appendChildåˆ°bodyä¸Š    
ç‰¹ç‚¹ï¼š ç®€å•å…¼å®¹æ€§å¥½ï¼Œåˆ©ç”¨scriptæ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„æ¼æ´ã€‚ä»…æ”¯æŒGETè¯·æ±‚ã€‚


### corsï¼ˆCross-origin resource sharingï¼‰
éœ€è¦æµè§ˆå™¨å’Œåç«¯åŒæ—¶æ”¯æŒï¼Œå…³é”®æ˜¯åç«¯     
æœåŠ¡ç«¯è®¾ç½®Access-Control-Allow-Originå°±å¯ä»¥å¼€å¯CORSã€‚è¯¥å±æ€§è¡¨ç¤ºå“ªäº›åŸŸåå¯ä»¥è®¿é—®æœ¬æœåŠ¡å™¨çš„èµ„æº
#### ç®€å•è¯·æ±‚å’Œå¤æ‚è¯·æ±‚
1. ç®€å•è¯·æ±‚
è¯·æ±‚æ–¹æ³•ï¼š GET\POST\HEADã€ Content-Type:æ–‡æœ¬ formè¡¨å•
2. å¤æ‚è¯·æ±‚
å¤æ‚è¯·æ±‚çš„CORSè¯·æ±‚ä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡httpæŸ¥è¯¢è¯·æ±‚ï¼Œä¸ºoptionæ–¹æ³•ï¼Œä¸ºé¢„æ£€æŸ¥ï¼Œé€šè¿‡è¯¥è¯·æ±‚æ¥çŸ¥é“æœåŠ¡ç«¯æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚



### postMessage
frame.contentWindow.postMessage(message, targetOrigin, [transfer]);

æœ‰ç‚¹æ¨¡ç³Šï¼Œ ä¸‹æ¬¡åœ¨è¡¥å……ä¸€ç‚¹


### websocket
WebSocket æ˜¯ä¸€ç§åŒå‘é€šä¿¡åè®®ï¼Œåœ¨å»ºç«‹è¿æ¥ä¹‹åï¼ŒWebSocket çš„ server ä¸ client éƒ½èƒ½ä¸»åŠ¨å‘å¯¹æ–¹å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚    
åœ¨å»ºç«‹è”æ¥çš„æ—¶å€™éœ€è¦httpåè®®ï¼Œè¿æ¥å»ºç«‹å¥½äº†å°±ä¸éœ€è¦äº†ã€‚


### ä»£ç†æœåŠ¡å™¨
åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨éœ€è¦éµå®ˆçš„æ ‡å‡†ï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨å‘æœåŠ¡å™¨è¯·æ±‚å°±ä¸éœ€è¦éµå¾ªåŒæºç­–ç•¥ã€‚    
ä»£ç†æœåŠ¡å™¨æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨ï¼Œæ‹¿åˆ°æœåŠ¡å™¨å“åº”æ•°æ®ï¼Œå†è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚   


### ngnixåå‘ä»£ç†
æ­å»ºä¸€ä¸ªä¸­è½¬ngnixæœåŠ¡å™¨ï¼Œç”¨äºè½¬å‘è¯·æ±‚    
å®ç°æ€è·¯ï¼š é€šè¿‡ngnixé…ç½®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ã€‚


### 7.window.name + iframe
window.nameå±æ€§çš„ç‹¬ç‰¹ä¹‹å¤„ï¼šnameå€¼åœ¨ä¸åŒçš„é¡µé¢ï¼ˆç”šè‡³ä¸åŒåŸŸåï¼‰åŠ è½½åä¾æ—§å­˜åœ¨ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒéå¸¸é•¿çš„ name å€¼ï¼ˆ2MBï¼‰



### 9.document.domain + iframe
è¯¥æ–¹å¼åªèƒ½ç”¨äºäºŒçº§åŸŸåç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ a.test.com å’Œ b.test.com é€‚ç”¨äºè¯¥æ–¹å¼ã€‚
åªéœ€è¦ç»™é¡µé¢æ·»åŠ  document.domain ='test.com' è¡¨ç¤ºäºŒçº§åŸŸåéƒ½ç›¸åŒå°±å¯ä»¥å®ç°è·¨åŸŸã€‚
å®ç°åŸç†ï¼šä¸¤ä¸ªé¡µé¢éƒ½é€šè¿‡jså¼ºåˆ¶è®¾ç½®document.domainä¸ºåŸºç¡€ä¸»åŸŸï¼Œå°±å®ç°äº†åŒåŸŸã€‚



[æ–‡ç« å‚è€ƒ](https://juejin.im/post/5c23993de51d457b8c1f4ee1#heading-15)
æœ‰ç‚¹éš¾å•ƒï¼Œæ¶‰åŠçŸ¥è¯†é¢æ¯”è¾ƒå¤šï¼Œæ…¢æ…¢æ¥


### 10. jsonp å’Œ ajaxçš„åŒºåˆ«
ajaxæ˜¯é€šè¿‡XMLHttpRequestæ¥è¯·æ±‚éæœ¬é¡µå†…å®¹
jsonpæ˜¯åŠ¨æ€æ·»åŠ scriptæ¥è°ƒç”¨æœåŠ¡å™¨æä¾›çš„jsè„šæœ¬ã€‚


------------------------------------------------------------

## [å­¦ä¹ åœ°å€](https://github.com/FatDong1/cross-domain)


## ç¬”è®°
1. corsè·¨åŸŸ  
åœ¨3000ç«¯å£èƒ½å¤Ÿè¯·æ±‚åˆ°3001ç«¯å£çš„æ•°æ®ï¼Œå³åœ¨ä¸€ä¸ªåŸŸèƒ½è¯·æ±‚åˆ°å¦ä¸€ä¸ªåŸŸçš„æ•°æ®
// å°ä¾‹å­çš„å®ç°ã€‚ 3001ç«¯å£è®¾ç½®ç›¸åº”å¤´:  "Access-Control-Allow-Origin": 'url',åœ¨3000ç«¯å£çš„é¡µé¢ä¸Šå‘é€ajaxå°±èƒ½è¯·æ±‚åˆ°3001çš„æ•°æ®
- è¦ç‚¹ï¼š è¦è®²åˆ°ç®€å•è¯·æ±‚å’Œå¤æ‚è¯·æ±‚ï¼Œoptioné¢„è¯·æ±‚ã€‚

2. jsonpè·¨åŸŸ 
æœåŠ¡å™¨ç«¯ä¹Ÿè¦åšä¸€äº›ç›¸åº”å¤„ç†
// myFunction
// myFunction({'message': 'hello world from JSONP!'})
var callbackName = req.query.callback;     //æŸ¥è¯¢å­—ç¬¦ä¸²æ‹¿åˆ°å›è°ƒå‡½æ•°åï¼Œæ‰§è¡Œä¸€ä¸‹callback(name)
res.send(callbackName+"({'message': 'hello world from JSONP!ğŸ™ƒ'});");

3. postMessage
postMessageè·¨åŸŸé€‚åˆäºåŒä¸€é¡µé¢çš„ä¸åŒçª—ä½“(iframe)ï¼Œæ‰€ä»¥åœ¨3001è¿™ä¸ªé¡µé¢ä¸ä¼šæ”¶åˆ°ä¿¡æ¯
 ```
 //æœ¬é¡µæ¡†
 document.getElementById('child').contentWindow.postMessage('æ”¶åˆ°ä¿¡æ¯ï¼š' + msg + ' --from 3000 portï¼ğŸ˜¨', 'http://localhost:3001');
 //å­é¡µé¢ï¼ˆ3001ç«¯å£ï¼‰
 window.parent.postMessage('æˆ‘æ”¶åˆ°ä½ çš„ä¿¡æ¯äº†ğŸ˜€--from 3001 port', 'http://localhost:3000/');
ç›‘å¬massage   window.addEventListener('message', receiveMessage, false);
```

4.  window.nameè·¨åŸŸ
åˆ©ç”¨window.name æ›´æ”¹src,nameä¸å˜çš„å±æ€§

5. location.hashè·¨åŸŸ

6. document.domainè·¨åŸŸ
ç”¨äºäºŒçº§åŸŸåç›¸åŒçš„æƒ…å†µä¸‹,ä¸¤ä¸ªé¡µé¢éƒ½jsè®¾ç½®document.domainå¼ºåˆ¶è®¾ç½®åŸºç¡€åŸŸåå®ç°åŒæº

7. åç«¯è®¾ç½®ä»£ç†proxyè·¨åŸŸ
æœåŠ¡å™¨ä¸éœ€è¦éµå¾ªè·¨åŸŸï¼Œæ‰€ä»¥ä»£ç†æœåŠ¡å™¨å¯ä»¥è·¨åŸŸã€‚
- http-proxy-middlewareæ’ä»¶è®¾ç½®ä»£ç†ã€‚
var proxy = require('http-proxy-middleware');
proxy({target: 'http://localhost:3001/', changeOrigin: true})
// changeOriginè®¾ç½®ä¸ºtrueï¼Œæœ¬åœ°ä¼šè™šæ‹Ÿä¸€ä¸ªæœåŠ¡ç«¯æ¥æ”¶ä½ çš„è¯·æ±‚å¹¶ä»£ä½ å‘é€è¯¥è¯·æ±‚
// http://localhost:3000/api   -->   http://localhost:3001/api
- ä¸ä½¿ç”¨æ’ä»¶é…ç½®ä»£ç†ï¼Œç›´æ¥ä½¿ç”¨httpæ¨¡å—å‘å‡ºè¯·æ±‚ï¼Œ åœ¨ http://localhost:3000 è¿è¡Œ
>       var proxy_url = 'http://localhost:3000/proxy?url=http://localhost:3001/';
        // æºå¸¦å‚æ•°{url: 'http://localhost:3001/'}å‘http://localhost:3000/proxyå‘å‡ºè¯·æ±‚ï¼Œè·å–æ•°æ®
        // porxy_urlæ˜¯ä»£ç†çš„urlï¼Œä¸æ˜¯æœ€ç»ˆè¯·æ±‚çš„urlï¼Œæœ€ç»ˆè¯·æ±‚çš„urlæ”¾åœ¨é—®å·åé¢ï¼Œåœ¨åå°å¯ä»¥é€šè¿‡req.query.urlè·å–
        // å‘porxy_urlå‘å‡ºè¯·æ±‚ï¼Œä¸ä¼šå­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œå› ä¸ºéƒ½æ˜¯è¿è¡Œåœ¨3000ç«¯å£
        // urlä¸ºå®é™…è¯·æ±‚çš„åœ°å€ï¼Œå‘3000/proxyå‘å‡ºè¯·æ±‚çš„åŒæ—¶æºå¸¦è¿™ä¸ªåŒ…å«urlçš„å¯¹è±¡ï¼Œè¿™ä¸ªurlåœ¨è¿™é‡Œåªæ˜¯å‚æ•°ï¼Œä¸æ˜¯è¯·æ±‚è·¯å¾„


8. websocket
WebSocketæ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œä½¿ç”¨ws://ï¼ˆéåŠ å¯†ï¼‰å’Œwss://ï¼ˆåŠ å¯†ï¼‰ä½œä¸ºåè®®å‰ç¼€ã€‚è¯¥åè®®ä¸å®è¡ŒåŒæºæ”¿ç­–ï¼Œåªè¦æœåŠ¡å™¨æ”¯æŒï¼Œå°±å¯ä»¥é€šè¿‡å®ƒè¿›è¡Œè·¨æºé€šä¿¡
æµç¨‹ã€‚ 
- æµè§ˆå™¨
    é¡µé¢cdnå¼•å…¥socket.io
    å’Œç›®æ ‡åŸŸé“¾æ¥var io = io.connect('http://127.0.0.1:3001');
    ç›‘å¬ io.on('data', function (data) {
            alert('2såæ”¹å˜æ•°æ®ğŸ‘»');
            p.innerHTML = data
        });
- æœåŠ¡å™¨
    å¼•å…¥socket.io
    var server = require('http').createServer();
    var io = require('socket.io')(server);
ç›‘å¬
    io.on('connection', function (client) {
        client.emit('data', 'Hello WebSocket from 3001.');
    });